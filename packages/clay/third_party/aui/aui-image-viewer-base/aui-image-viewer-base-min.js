YUI.add("aui-image-viewer-base",function(e,t){var n=e.getClassName("image","viewer","caption"),r=e.getClassName("image","viewer","close"),i=e.getClassName("image","viewer","control"),s=e.getClassName("image","viewer","current","image"),o=e.getClassName("image","viewer","image"),u=e.getClassName("image","viewer","image","container"),a=e.getClassName("image","viewer","image","list"),f=e.getClassName("image","viewer","info"),l=e.getClassName("image","viewer","loading"),c=e.getClassName("image","viewer","loading","icon"),h=e.getClassName("well");e.ImageViewer=e.Base.create("image-viewer",e.Widget,[e.WidgetCssClass,e.WidgetStdMod,e.WidgetToggle,e.WidgetPosition,e.WidgetStack,e.WidgetPositionAlign,e.WidgetPositionConstrain,e.WidgetResponsive,e.WidgetModality],{TPL_CAPTION:'<h4 class="'+n+'"></h4>',TPL_CLOSE:'<button class="close '+r+'" type="button">'+'<span class="glyphicon glyphicon-remove"></span></button>',TPL_CONTROL_LEFT:'<a href="#" class="carousel-control left '+i+'"><span class="glyphicon glyphicon-chevron-left"></span></a>',TPL_CONTROL_RIGHT:'<a href="#" class="carousel-control right '+i+'"><span class="glyphicon glyphicon-chevron-right"></span></a>',TPL_IMAGE:'<img class="'+o+'"></img>',TPL_IMAGE_CONTAINER:'<div class="'+u+'">'+'<span class="glyphicon glyphicon-time '+c+'"></span></div>',TPL_IMAGE_LIST:'<div class="'+a+'"></div>',TPL_INFO:'<h5 class="'+f+'"></h5>',initializer:function(){this._eventHandles=[this.after("currentIndexChange",this._showCurrentImage),this.after("linksChange",this._afterLinksChange),this.after("preloadAllImagesChange",this._preloadAll),this.after("responsive",this._afterResponsive),this.after("showControlsChange",this._syncControlsUI),this.on("responsive",this._onResponsive),e.after(this._afterFillHeight,this,"fillHeight"),e.after(this._afterUISetVisible,this,"_uiSetVisible")]},renderUI:function(){this._renderImages(),this._renderControls(),this._renderFooter()},bindUI:function(){this._attachLinkEvent(),this._eventHandles.push(this._controlLeftEl.on("click",e.bind(this.prev,this)),this._controlRightEl.on("click",e.bind(this.next,this)),this._closeEl.on("click",e.bind(this.hide,this)),e.getDoc().on("keydown",e.bind(this._onKeydown,this)))},destructor:function(){(new e.EventHandle(this._eventHandles)).detach(),this._detachLinkEvent(),this._controlLeftEl.remove(!0),this._controlRightEl.remove(!0),this._closeEl.remove(!0)},getLink:function(e){return this.get("links").item(e)},hasNext:function(){return this.get("currentIndex")+1<this.get("links").size()},hasPrev:function(){return this.get("currentIndex")>0},next:function(){this.hasNext()&&this.set("currentIndex",this.get("currentIndex")+1)},prev:function(){this.hasPrev()&&this.set("currentIndex",this.get("currentIndex")-1)},_afterFillHeight:function(){var e=this.getStdModNode(this.get("fillHeight"));e.setStyle("lineHeight",e.getStyle("height"))},_afterLinksChange:function(){this._renderImages(),this._attachLinkEvent()},_afterResponsive:function(){var e=this._getCurrentImage();e&&(this.footerNode.setStyle("width",""),e.setStyles({maxHeight:"100%",maxWidth:"100%"}),this.bodyNode.setStyles({height:"",lineHeight:""}),this._fillHeight(),this._setAlignCenter(!0))},_afterUISetVisible:function(){this.get("visible")?(this._showCurrentImage(),this._fillHeight()):(this._closeEl.hide(),this._syncControlsUI())},_attachLinkEvent:function(){this._detachLinkEvent(),this._linkEvent=this.get("links").on("click",e.bind(this._onClickLinks,this))},_detachLinkEvent:function(){this._linkEvent&&(this._linkEvent.detach(),this._linkEvent=null)},_getCurrentImageContainer:function(){var e=this.get("contentBox").all("."+u);return e.item(this.get("currentIndex"))},_getCurrentImage:function(){var e=this._getCurrentImageContainer();return e.one("."+o)},_getInfoTemplate:function(t){return e.Lang.sub(t,{current:this.get("currentIndex")+1,total:this.get("links").size()})},_loadImage:function(e){this.fire("load"+e)},_onClickLinks:function(e){e.preventDefault(),this.show(),this.set("currentIndex",this.get("links").indexOf(e.currentTarget))},_onCurrentImageReady:function(){var t=this,n=this._getCurrentImage();this.updateDimensionsWithNewRatio(),this.get("animated")&&this.get("visible")&&(n.setStyle("opacity",0),n.fx||(n.plug(e.Plugin.NodeFX,this.get("imageAnim")),n.fx.on("end",function(e){t.fire("anim",{animated:e,image:n})})),n.fx.stop().run()),this.fire("load",{image:n})},_onImageLoad:function(e,t){e.setData("loaded",!0),e.get("parentNode").removeClass(l),this.get("visible")&&t===this.get("currentIndex")&&this._onCurrentImageReady()},_onKeydown:function(e){if(!this.get("visible"))return!1;e.isKey("LEFT")?this.prev():e.isKey("RIGHT")?this.next():e.isKey("ESC")&&this.hide()},_onResponsive:function(){var e=this._getCurrentImage();e&&(this.footerNode.setStyle("width",0),e.setStyles({maxHeight:"none",maxWidth:"none"}))},_preloadAll:function(){var e=this;this.get("preloadAllImages")&&this.get("links").each(function(t,n){e._loadImage(n)})},_renderControls:function(){var t=e.one("body");this._controlLeftEl=e.Node.create(this.TPL_CONTROL_LEFT),t.append(this._controlLeftEl.hide()),this._controlRightEl=e.Node.create(this.TPL_CONTROL_RIGHT),t.append(this._controlRightEl.hide()),this._closeEl=e.Node.create(this.TPL_CLOSE),t.append(this._closeEl.hide())},_renderFooter:function(){var t=e.Node.create("<div></div>");this._captionEl=e.Node.create(this.TPL_CAPTION),t.append(this._captionEl),this._infoEl=e.Node.create(this.TPL_INFO),t.append(this._infoEl),this.setStdModContent("footer",t)},_renderImage:function(t,n){var r,i=e.Node.create(this.TPL_IMAGE),s=this.get("links").item(t);n.prepend(i),e.UA.ie===8&&(i=n.one("."+o)),this._eventHandles.push(i.once("load",e.bind(this._onImageLoad,this,i,t))),r=new e.ImgLoadGroup,r.addCustomTrigger("load"+t,this),r.registerImage({domId:i.generateID(),srcUrl:s.attr("href")})},_renderImages:function(){var t=this,n,r=e.Node.create(this.TPL_IMAGE_LIST);this.get("links").each(function(i,s){n=e.Node.create(t.TPL_IMAGE_CONTAINER),n.addClass
(l),r.append(n),t._renderImage(s,n)}),this.setStdModContent("body",r),this._preloadAll()},_setImageAnim:function(t){return e.merge({to:{opacity:1},duration:.8},t)},_setLinks:function(t){return t instanceof e.NodeList?t:e.Lang.isString(t)?e.all(t):new e.NodeList([t])},_showCurrentImage:function(){var e,t=this.get("contentBox"),n=this.get("currentIndex"),r,i;if(!this.get("visible"))return;e=t.all("."+u),e.removeClass(s),i=e.item(this.get("currentIndex")),i.addClass(s),this._closeEl.show(),this._syncControlsUI(),this._syncCaptionUI(),this._syncInfoUI(),this._loadImage(n),r=i.one("."+o),this.fire("request",{image:r}),this.get("preloadNeighborImages")&&(this.hasPrev()&&this._loadImage(n-1),this.hasNext()&&this._loadImage(n+1)),r.getData("loaded")&&this._onCurrentImageReady()},_syncCaptionUI:function(){var e=this.get("caption"),t;this.get("captionFromTitle")&&(t=this.get("links").item(this.get("currentIndex")),e=t.attr("title")?t.attr("title"):e),this._captionEl.set("text",e)},_syncControlsUI:function(){this.get("visible")&&this.get("showControls")?(this._controlLeftEl[this.hasPrev()?"show":"hide"](),this._controlRightEl[this.hasNext()?"show":"hide"]()):(this._controlLeftEl.hide(),this._controlRightEl.hide())},_syncInfoUI:function(){this._infoEl.setHTML(this.get("infoTemplate"))}},{ATTRS:{animated:{value:!0,validator:e.Lang.isBoolean},caption:{value:"blank",validator:e.Lang.isString},captionFromTitle:{value:!0,validator:e.Lang.isBoolean},centered:{value:!0},cssClass:{value:h},currentIndex:{value:0,validator:e.Lang.isNumber},imageAnim:{value:{},setter:"_setImageAnim",validator:e.Lang.isObject},infoTemplate:{getter:"_getInfoTemplate",value:"Image {current} of {total}",validator:e.Lang.isString},links:{setter:"_setLinks"},modal:{value:!0},preloadAllImages:{value:!1,validator:e.Lang.isBoolean},preloadNeighborImages:{value:!0,validator:e.Lang.isBoolean},showControls:{value:!0,validator:e.Lang.isBoolean},visible:{value:!1}},CSS_PREFIX:e.getClassName("image-viewer")})},"2.5.0",{requires:["anim","imageloader","widget","widget-modality","widget-position","widget-position-align","widget-position-constrain","widget-stack","widget-stdmod","aui-event","aui-node-base","aui-widget-cssclass","aui-widget-responsive","aui-widget-toggle"],skinnable:!0});
