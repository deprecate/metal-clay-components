YUI.add("aui-carousel",function(e,t){var n=e.Lang,r=e.getClassName,i=r("carousel","item"),s=r("carousel","item","active"),o=r("carousel","item","active","transition"),u=r("carousel","item","transition"),a=r("carousel","menu"),f=r("carousel","menu","active"),l=r("carousel","menu","index"),c=r("carousel","menu","item"),h=r("carousel","menu","next"),p=r("carousel","menu","play"),d=r("carousel","menu","pause"),v=r("carousel","menu","prev"),m=[c,l].join(" "),g=[c,l,f].join(" "),y=r("carousel","outside","menu"),b="inside",w="outside",E="."+l,S="."+d,x="."+p,T=[x,S].join(),N=e.Widget.UI_SRC,C={src:N},k=e.Component.create({NAME:"carousel",ATTRS:{activeIndex:{value:0,setter:"_setActiveIndex"},animationTime:{value:.5},intervalTime:{value:2},itemSelector:{value:">*"},nodeMenu:{value:null,setter:"_setNodeMenu"},nodeMenuItemSelector:{value:"."+c},nodeMenuPosition:{value:b,validator:"_validateNodeMenuPosition"},pauseOnHover:{value:!1,validator:n.isBoolean},playing:{value:!0}},AUGMENTS:[e.WidgetResponsive],UI_ATTRS:["pauseOnHover","nodeMenuPosition"],prototype:{TPL_ITEM:'<li><a class="'+c+' {cssClasses}">{index}</a></li>',TPL_MENU:'<div class="'+a+'"><menu>'+'<li><a class="'+c+" "+p+'"></a></li>'+'<li><a class="'+c+" "+v+'"></a></li>'+"{items}"+'<li><a class="'+c+" "+h+'"></a></li>'+"</menu></div>",animation:null,nodeSelection:null,nodeMenu:null,hoverEventHandles:null,initializer:function(){var t=this;t.animation=new e.Anim({duration:t.get("animationTime"),to:{opacity:1}}),this._eventHandles=[this.after("responsive",this._afterResponsive)],this.publish({showImage:{defaultFn:this._defShowImageFn}})},destructor:function(){(new e.EventHandle(this._eventHandles)).detach()},renderUI:function(){var e=this;e._updateNodeSelection(),e.nodeMenu=e.get("nodeMenu"),e._updateMenuNodes()},bindUI:function(){var e=this;e.after({activeIndexChange:e._afterActiveIndexChange,animationTimeChange:e._afterAnimationTimeChange,intervalTimeChange:e._afterIntervalTimeChange,itemSelectorChange:e._afterItemSelectorChange,nodeMenuItemSelectorChange:e._afterNodeMenuItemSelectorChange,playingChange:e._afterPlayingChange}),e._bindMenu(),e.get("playing")===!0&&e._afterPlayingChange({prevVal:!1,newVal:!0})},syncUI:function(){var e=this;e._uiSetActiveIndex(e.get("activeIndex"))},item:function(e){var t=this;t.set("activeIndex",e)},next:function(){var e=this;e._updateIndexNext()},pause:function(){var e=this;e.set("playing",!1)},play:function(){var e=this;e.set("playing",!0)},prev:function(){var e=this;e._updateIndexPrev()},_afterActiveIndexChange:function(e){var t=this;t._uiSetActiveIndex(e.newVal,{prevVal:e.prevVal,animate:t.get("playing"),src:e.src})},_afterAnimationTimeChange:function(e){var t=this;t.animation.set("duration",e.newVal)},_afterItemSelectorChange:function(){var e=this;e._updateNodeSelection()},_afterNodeMenuItemSelectorChange:function(e){var t=this;t.nodeMenuItemSelector=e.newVal,t._updateMenuNodes(),t._bindMenu()},_afterIntervalTimeChange:function(){var e=this;e._clearIntervalRotationTask(),e._createIntervalRotationTask()},_afterPlayingChange:function(e){var t=this,n=t.nodeMenu.one(T),r=e.newVal,i=d,s=p,o="_clearIntervalRotationTask";r&&(i=p,s=d,o="_createIntervalRotationTask"),t[o](),n&&n.replaceClass(i,s)},_afterResponsive:function(e){this.nodeSelection.each(function(t){t.getStyle("backgroundImage")!=="none"&&t.setStyles({backgroundRepeat:"no-repeat",backgroundSize:"contain",height:e.height+"px",width:e.width+"px"})})},_bindMenu:function(){var e=this,t=e.nodeMenu,n=e.get("nodeMenuItemSelector");e._menuClickDelegateHandler&&e._menuClickDelegateHandler.detach(),e._menuClickDelegateHandler=t.delegate("click",e._onClickDelegate,n,e),e.nodeMenuItemSelector=n},_clearIntervalRotationTask:function(){var e=this;clearInterval(e._intervalRotationTask)},_createIndexRandom:function(){var e=this;return Math.ceil(Math.random()*e.nodeSelection.size())-1},_createIntervalRotationTask:function(){var e=this;e._clearIntervalRotationTask(),e._intervalRotationTask=setInterval(function(){e._updateIndexNext({animate:!0})},e.get("intervalTime")*1e3)},_defShowImageFn:function(e){var t=this,r=this.get("activeIndex"),i=!n.isUndefined(e.prevVal),a=this.nodeSelection.item(r),f,l;a.addClass(s),i&&(f=this.nodeSelection.item(e.prevVal),f.removeClass(s),this.animation.stop(),e.animate&&(a.setStyle("opacity","0"),a.addClass(o),f.addClass(u),l=this.animation.on("end",function(e){t._onAnimationEnd(e,a,f),l.detach()}),this.animation.set("node",a),this.animation.run()))},_isMouseInsideMenu:function(e){var t=this.get("nodeMenu").get("region");return t.left>e.clientX||e.clientX>t.right||t.top>e.clientY||e.clientY>t.bottom},_onAnimationEnd:function(e,t,n){n&&n.removeClass(u),t.removeClass(o)},_onCarouselEnter:function(e){this._isMouseInsideMenu(e)&&this._pauseOnEnter()},_onCarouselLeave:function(){this._playOnLeave()},_onClickDelegate:function(e){var t=this;e.preventDefault();var n=e.currentTarget,r;n.hasClass(l)?r=t._onMenuItemClick:n.hasClass(v)?r=t._updateIndexPrev:n.hasClass(h)?r=t._updateIndexNext:n.test(T)&&(r=t._onMenuPlayClick),r&&r.apply(t,arguments)},_onMenuEnter:function(e){e.relatedTarget&&e.relatedTarget.hasClass(i)&&this._playOnLeave()},_onMenuItemClick:function(e){var t=this;e.preventDefault();var n=t.menuNodes.indexOf(e.currentTarget);t.set("activeIndex",n,C)},_onMenuLeave:function(e){e.relatedTarget&&e.relatedTarget.hasClass(i)&&this._pauseOnEnter()},_onMenuPlayClick:function(){this.set("playing",!this.get("playing"))},_pauseOnEnter:function(){this.get("playing")&&(this.pause(),this._pausedOnEnter=!0)},_playOnLeave:function(){this._pausedOnEnter&&(this.play(),this._pausedOnEnter=!1)},_renderMenu:function(){var t=this,r=t.get("activeIndex"),i=[],s,o=t.nodeSelection.size();for(s=0;s<o;s++)i.push(n.sub(this.TPL_ITEM,{cssClasses:r===s?g:m,index:s}));var u=e.Node.create(n.sub(this.TPL_MENU,{items:i.join(" ")}));return t.get("boundingBox").appendChild(u),u},_setActiveIndex:function(e){var t=this;return e==="rand"?e=t._createIndexRandom():e=Math.max(Math
.min(e,t.nodeSelection.size()),-1),e},_setNodeMenu:function(t){var n=this;return e.one(t)||n._renderMenu()},_uiSetActiveIndex:function(e,t){var r=this.menuNodes.item(e),i;r&&r.addClass(f),t&&!n.isUndefined(t.prevVal)&&(i=this.menuNodes.item(t.prevVal),i&&i.removeClass(f)),this.fire("showImage",{animate:t&&t.animate,prevVal:t&&t.prevVal}),t&&t.src===N&&t.animate&&this._createIntervalRotationTask()},_uiSetNodeMenuPosition:function(e){this.get("boundingBox").toggleClass(y,e===w),e===w?this.set("gutter",[0,this.nodeMenu.get("offsetHeight")]):this.set("gutter",[0,0])},_uiSetPauseOnHover:function(t){var n=this.get("boundingBox"),r=this.get("nodeMenu");t?this.hoverEventHandles=[n.on("mouseenter",e.bind(this._onCarouselEnter,this)),n.on("mouseleave",e.bind(this._onCarouselLeave,this)),r.on("mouseenter",e.bind(this._onMenuEnter,this)),r.on("mouseleave",e.bind(this._onMenuLeave,this))]:((new e.EventHandle(this.hoverEventHandles)).detach(),this.hoverEventHandles=null)},_updateIndexNext:function(e){var t=this,n=t.get("activeIndex"),r=t.nodeSelection.size(),i=n+1;i>r-1&&(i=0),e&&(e.src=N),t.set("activeIndex",i,e)},_updateIndexPrev:function(e){var t=this,n=t.get("activeIndex"),r=n-1;r<0&&(r=t.nodeSelection.size()-1),e&&(e.src=N),t.set("activeIndex",r,e)},_updateMenuNodes:function(){var e=this;e.nodeMenu=e.get("nodeMenu"),e.menuNodes=e.nodeMenu.all(E)},_updateNodeSelection:function(){var e=this,t=e.get("itemSelector"),n=e.get("contentBox").all(t);n.addClass(i),e.nodeSelection=n},_validateNodeMenuPosition:function(e){return e===b||e===w},_intervalRotationTask:null}});e.Carousel=k},"2.5.0",{requires:["anim","node-event-delegate","aui-component","aui-widget-responsive"],skinnable:!0});
