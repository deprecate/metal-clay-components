YUI.add("aui-datatable-edit",function(e,t){var n=e.Lang,r=e.Array,i=n.isArray,s=n.isBoolean,o=n.isFunction,u=n.isObject,a=n.isString,f=n.isValue,l=n.String,c=e.DataType,h=function(t){return t instanceof e.BaseCellEditor},p=e.WidgetStdMod,d=/<br\s*\/?>/gi,v=/[\r\n]/g,m=e.getClassName("form","control"),g=e.getClassName("celleditor","edit"),y=e.getClassName("celleditor","edit","add","option"),b=e.getClassName("celleditor","edit","dd","handle"),w=e.getClassName("celleditor","edit","delete","option"),E=e.getClassName("celleditor","edit","hide","option"),S=e.getClassName("celleditor","edit","input","name"),x=e.getClassName("celleditor","edit","input","value"),T=e.getClassName("celleditor","edit","label"),N=e.getClassName("celleditor","edit","link"),C=e.getClassName("celleditor","edit","option","row"),k=e.getClassName("celleditor","element"),L=e.getClassName("celleditor","option"),A=e.getClassName("glyphicon"),O=e.getClassName("glyphicon","resize","vertical"),M="<br/>",_=function(){};_.NAME="dataTableCellEditorSupport",_.EDITOR_ZINDEX=9999,_.ATTRS={editEvent:{setter:"_setEditEvent",validator:a,value:"click"}},e.mix(_.prototype,{initializer:function(){var e=this,t=e.get("editEvent");e.CLASS_NAMES_CELL_EDITOR_SUPPORT={cell:e.getClassName("cell"),readOnly:e.getClassName("read","only")},e.after("render",e._afterCellEditorSupportRender),e.delegate(t,e._onEditCell,"."+e.CLASS_NAMES_CELL_EDITOR_SUPPORT.cell,e)},getEditor:function(e,t){var n=t.editor,r=e.get("editor");return n===!1||r===!1?null:r||n},_afterCellEditorSupportRender:function(){var t=this;t._syncModelsReadOnlyUI(),t.body.after(e.bind(t._syncModelsReadOnlyUI,t),t.body,"render")},_onEditCell:function(t){var n=this,r=n.get("activeCell"),i=t.alignNode||r,s=n.getColumn(i),o=n.getRecord(i),u=n.getEditor(o,s);h(u)&&!o.get("readOnly")&&(u.get("rendered")||(u.on({visibleChange:e.bind(n._onEditorVisibleChange,n),save:e.bind(n._onEditorSave,n)}),u.set("zIndex",_.EDITOR_ZINDEX),u.render()),u.set("value",o.get(s.key)),u.show().move(i.getXY()))},_onEditorSave:function(e){var t=this,n=e.currentTarget,r=t.getActiveColumn(),i=t.getActiveRecord();n.set("value",e.newVal),t.set("activeCell",t.get("activeCell")),i.set(r.key,e.newVal),t.highlight&&t.highlight.clear()},_onEditorVisibleChange:function(e){var t=e.currentTarget;e.newVal&&t._syncFocus()},_syncModelReadOnlyUI:function(e){var t=this,n=t.getRow(e);n.toggleClass(t.CLASS_NAMES_CELL_EDITOR_SUPPORT.readOnly,e.get("readOnly")===!0)},_syncModelsReadOnlyUI:function(){var e=this;e.get("data").each(function(t){e._syncModelReadOnlyUI(t)})},getCellEditor:function(){return this.getEditor.apply(this,arguments)},getRecordColumnValue:function(e,t){return e.get(t.key)}}),e.DataTable.CellEditorSupport=_,e.Base.mix(e.DataTable,[_]);var D=e.Component.create({NAME:"baseCellEditor",ATTRS:{editable:{value:!1,validator:s},elementName:{value:"value",validator:a},footerContent:{value:""},hideOnSave:{value:!0,validator:s},inputFormatter:{value:function(e){return a(e)&&(e=e.replace(v,M)),e}},outputFormatter:{value:function(e){var t=this;return a(e)&&(t.get("unescapeValue")&&(e=l.unescapeEntities(e)),e=e.replace(d,"n")),e}},showToolbar:{value:!0,validator:s},strings:{value:{edit:"Edit",save:"Save",cancel:"Cancel"}},tabIndex:{value:1},toolbar:{setter:"_setToolbar",validator:u,value:null},unescapeValue:{value:!0,validator:s},validator:{setter:"_setValidator",validator:u,value:null},value:{value:""},visible:{value:!1}},EXTENDS:e.Overlay,UI_ATTRS:["editable","showToolbar","value"],prototype:{CONTENT_TEMPLATE:"<form></form>",ELEMENT_TEMPLATE:null,elements:null,validator:null,_hDocMouseDownEv:null,initializer:function(){this._initEvents()},destructor:function(){var e=this,t=e._hDocMouseDownEv,n=e.toolbar,r=e.validator;t&&t.detach(),n&&n.destroy(),r&&r.destroy()},bindUI:function(){var t=this;t.get("boundingBox").on("key",e.bind(t._onEscKey,t),"down:27")},formatValue:function(e,t){var n=this;return o(e)&&(t=e.call(n,t)),t},getValue:function(){var e=this;return e.formatValue(e.get("inputFormatter"),e.getElementsValue())},_initEvents:function(){var t=this;t.publish({cancel:{defaultFn:t._defCancelFn},initEdit:{defaultFn:t._defInitEditFn,fireOnce:!0},initValidator:{defaultFn:t._defInitValidatorFn,fireOnce:!0},initToolbar:{defaultFn:t._defInitToolbarFn,fireOnce:!0},save:{defaultFn:t._defSaveFn}}),t.after({render:t._afterRender,visibleChange:e.debounce(t._debounceVisibleChange,350,t)}),t.on({"form-validator:submit":e.bind(t._onSubmit,t)})},_afterRender:function(){var e=this;e._handleInitValidatorEvent(),e._handleInitToolbarEvent()},_defCancelFn:function(){this.hide()},_defInitValidatorFn:function(){this.validator=new e.FormValidator(this.get("validator"))},_defInitToolbarFn:function(){var t=this,n=t.get("editable");t.toolbar=(new e.Toolbar(t.get("toolbar"))).render(t.footerNode),n&&t._uiSetEditable(n)},_defSaveFn:function(){var e=this;e.get("hideOnSave")&&e.hide()},_debounceVisibleChange:function(t){var n=this,r=n._hDocMouseDownEv;t.newVal?r||(n._hDocMouseDownEv=e.getDoc().on("mousedown",e.bind(n._onDocMouseDownExt,n))):r&&(r.detach(),n._hDocMouseDownEv=null)},_handleCancelEvent:function(){var e=this;e.fire("cancel")},_handleEditEvent:function(){var e=this;e.fire("edit")},_handleInitEditEvent:function(){var e=this;e.get("rendered")&&this.fire("initEdit")},_handleInitValidatorEvent:function(){var e=this;e.get("rendered")&&this.fire("initValidator")},_handleInitToolbarEvent:function(){var e=this;e.get("rendered")&&e.get("showToolbar")&&this.fire("initToolbar")},_handleSaveEvent:function(){var e=this;e.validator.hasErrors()||e.fire("save",{newVal:e.getValue(),prevVal:e.get("value")})},_onDocMouseDownExt:function(e){var t=this,n=t.get("boundingBox");n.contains(e.target)||t.set("visible",!1)},_onEscKey:function(){var e=this;e.hide()},_onSubmit:function(e){var t=e.validator;t&&t.formEvent.halt()},_setToolbar:function(t){var n=this,r=n.getStrings();return e.merge({activeState:!1,children:[[{on:{click:e.bind(n._handleSaveEvent,n)},label:r.save,icon:"glyphicon glyphicon-ok-sign"
},{on:{click:e.bind(n._handleCancelEvent,n)},label:r.cancel}]]},t)},_setValidator:function(t){var n=this;return e.merge({boundingBox:n.get("contentBox"),bubbleTargets:n},t)},_uiSetShowToolbar:function(e){var t=this,n=t.footerNode;e?n.show():n.hide(),t._handleInitToolbarEvent()},getElementsValue:function(){var e=this,t=e.elements;return t?t.get("value"):""},renderUI:function(){var t=this;t.ELEMENT_TEMPLATE&&(t.elements=e.Node.create(t.ELEMENT_TEMPLATE),t._syncElementsName(),t.setStdModContent(p.BODY,t.elements))},_defInitEditFn:function(){},_syncElementsFocus:function(){var e=this;e.elements.selectText()},_syncElementsName:function(){var e=this;e.elements.setAttribute("name",e.get("elementName"))},_syncFocus:function(){var t=this;e.later(0,t,t._syncElementsFocus)},_uiSetEditable:function(t){var n=this,r=n.toolbar;n.get("rendered")&&r&&(t?r.add([{icon:"glyphicon glyphicon-edit",label:n.getString("edit"),on:{click:e.bind(n._handleEditEvent,n)}}],1):r.remove(1))},_uiSetValue:function(e){var t=this,n=t.elements;n&&n.val(t.formatValue(t.get("outputFormatter"),e))}}});e.BaseCellEditor=D;var P=e.Component.create({NAME:"optionsCellEditor",ATTRS:{inputFormatter:{value:null},options:{setter:"_setOptions",value:{},validator:u},outputFormatter:{value:null},selectedAttrName:{value:"selected",validator:a},strings:{value:{add:"Add",cancel:"Cancel",addOption:"Add option",edit:"Edit options",editOptions:"Edit option(s)",name:"Name",remove:"Remove",save:"Save",stopEditing:"Stop editing",value:"Value"}}},EXTENDS:e.BaseCellEditor,UI_ATTRS:["options"],prototype:{EDIT_TEMPLATE:'<div class="'+g+'"></div>',EDIT_OPTION_ROW_TEMPLATE:'<div class="'+C+'">'+'<span class="'+[b,A,O].join(" ")+'"></span>'+'<input class="'+S+'" size="7" placeholder="{titleName}" title="{titleName}" type="text" value="{valueName}" /> '+'<input class="'+x+'" size="7" placeholder="{titleValue}" title="{titleValue}" type="text" value="{valueValue}" /> '+'<a class="'+[N,w].join(" ")+'" href="javascript:void(0);">{remove}</a> '+"</div>",EDIT_ADD_LINK_TEMPLATE:'<a class="'+[N,y].join(" ")+'" href="javascript:void(0);">{addOption}</a> ',EDIT_LABEL_TEMPLATE:'<div class="'+T+'">{editOptions}</div>',editContainer:null,editSortable:null,options:null,initializer:function(){var e=this;e.on("edit",e._onEditEvent),e.on("save",e._onSave),e.after("initToolbar",e._afterInitToolbar)},addNewOption:function(t,n){var r=this,i=r.editContainer.one("."+y),s=e.Node.create(r._createEditOption(t||"",n||""));i.placeBefore(s),s.one("input").focus()},removeOption:function(e){e.remove()},saveOptions:function(){var e=this,t=e.editContainer;if(t){var n=t.all("."+S),r=t.all("."+x),i={};n.each(function(e,t){var n=e.val(),s=r.item(t).val();i[s]=n}),e.set("options",i),e._uiSetValue(e.get("value")),e.toggleEdit()}},toggleEdit:function(){var e=this;e.editContainer.toggle()},_createOptions:function(t){var r=this,i=r.elements,s=[],o=[],u=r.OPTION_TEMPLATE,a=r.OPTION_WRAPPER;e.each(t,function(t,r){var i={id:e.guid(),label:t,name:r,value:r};u&&s.push(n.sub(u,i)),a&&o.push(n.sub(a,i))});var f=e.NodeList.create(s.join("")),l=e.NodeList.create(o.join(""));l.size()?(l.each(function(e,t){e.prepend(f.item(t))}),i.setContent(l)):i.setContent(f),r.options=f},_createEditBuffer:function(){var t=this,r=t.getStrings(),i=[];return i.push(n.sub(t.EDIT_LABEL_TEMPLATE,{editOptions:r.editOptions})),e.each(t.get("options"),function(e,n){i.push(t._createEditOption(e,n))}),i.push(n.sub(t.EDIT_ADD_LINK_TEMPLATE,{addOption:r.addOption})),i.join("")},_createEditOption:function(e,t){var r=this,i=r.getStrings();return n.sub(r.EDIT_OPTION_ROW_TEMPLATE,{remove:i.remove,titleName:i.name,titleValue:i.value,valueName:e,valueValue:t})},_defInitEditFn:function(){var t=this,n=e.Node.create(t.EDIT_TEMPLATE);n.delegate("click",e.bind(t._onEditLinkClickEvent,t),"."+N),n.delegate("keydown",e.bind(t._onEditKeyEvent,t),"input"),t.editContainer=n,t.setStdModContent(p.BODY,n.hide(),p.AFTER),t.editSortable=(new e.Sortable({container:n,handles:["."+b],nodes:"."+C,opacity:".3"})).delegate.dd.plug(e.Plugin.DDConstrained,{constrain:n,stickY:!0}),t._syncEditOptionsUI()},_getSelectedOptions:function(){var t=this,n=[];return t.options.each(function(e){e.get(t.get("selectedAttrName"))&&n.push(e)}),e.all(n)},_onEditEvent:function(){var e=this;e._handleInitEditEvent(),e.toggleEdit(),e._syncEditOptionsUI()},_onEditLinkClickEvent:function(e){var t=this,n=e.currentTarget;n.test("."+y)?t.addNewOption():n.test("."+E)?t.toggleEdit():n.test("."+w)&&t.removeOption(n.ancestor("."+C)),e.halt()},_onEditKeyEvent:function(e){var t=this,n=e.currentTarget;if(e.isKey("return")){var r=n.next("input");r?r.selectText():t.addNewOption(),e.halt()}},_onSave:function(){var e=this;e.saveOptions()},_setOptions:function(e){var t={};return i(e)?r.each(e,function(e){t[e]=e}):u(e)&&(t=e),t},_syncEditOptionsUI:function(){var e=this;e.editContainer.setContent(e._createEditBuffer())},_uiSetOptions:function(e){var t=this;t._createOptions(e),t._uiSetValue(t.get("value")),t._syncElementsName()},_uiSetValue:function(e){var t=this,s=t.options;return s&&s.size()&&(s.set(t.get("selectedAttrName"),!1),f(e)&&(i(e)||(e=String(e).split(",")),r.each(e,function(e){s.filter('[value="'+n.trim(e)+'"]').set(t.get("selectedAttrName"),!0)}))),e}}});e.BaseOptionsCellEditor=P;var H=e.Component.create({NAME:"textCellEditor",EXTENDS:e.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<input autocomplete="off" class="'+[k,m].join(" ")+'" type="text" />'}});e.TextCellEditor=H;var B=e.Component.create({NAME:"textAreaCellEditor",EXTENDS:e.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<textarea class="'+[k,m].join(" ")+'"></textarea>'}});e.TextAreaCellEditor=B;var j=e.Component.create({NAME:"dropDownCellEditor",ATTRS:{multiple:{value:!1,validator:s}},EXTENDS:e.BaseOptionsCellEditor,UI_ATTRS:["multiple"],prototype:{ELEMENT_TEMPLATE:'<select class="'+[k,m].join(" ")+'"></select>',OPTION_TEMPLATE:'<option value="{value}">{label}</option>',getElementsValue:function(){var e=this;return e.get("multiple")?e
._getSelectedOptions().get("value"):e.elements.get("value")},_syncElementsFocus:function(){var e=this;e.elements.focus()},_uiSetMultiple:function(e){var t=this,n=t.elements;e?n.setAttribute("multiple","multiple"):n.removeAttribute("multiple")}}});e.DropDownCellEditor=j;var F=e.Component.create({NAME:"checkboxCellEditor",ATTRS:{selectedAttrName:{value:"checked"}},EXTENDS:e.BaseOptionsCellEditor,prototype:{ELEMENT_TEMPLATE:'<div class="'+k+'"></div>',OPTION_TEMPLATE:'<input class="'+L+'" id="{id}" name="{name}" type="checkbox" value="{value}"/>',OPTION_WRAPPER:'<label class="checkbox" for="{id}"> {label}</label>',getElementsValue:function(){var e=this;return e._getSelectedOptions().get("value")},_syncElementsFocus:function(){var e=this,t=e.options;t&&t.size()&&t.item(0).focus()},_syncElementsName:function(){var e=this,t=e.options;t&&t.setAttribute("name",e.get("elementName"))}}});e.CheckboxCellEditor=F;var I=e.Component.create({NAME:"radioCellEditor",EXTENDS:e.CheckboxCellEditor,prototype:{OPTION_TEMPLATE:'<input class="field-input-choice" id="{id}" name="{name}" type="radio" value="{value}"/>',OPTION_WRAPPER:'<label class="radio" for="{id}"> {label}</label>',getElementsValue:function(){var e=this;return e._getSelectedOptions().get("value")[0]}}});e.RadioCellEditor=I;var q=e.Component.create({NAME:"dateCellEditor",EXTENDS:e.BaseCellEditor,ATTRS:{bodyContent:{value:""},calendar:{setter:"_setCalendar",validator:u,value:null},dateFormat:{value:"%Y-%m-%d",validator:a},inputFormatter:{value:function(e){var t=this,n=[];return r.each(e,function(e){n.push(t.formatDate(e).toString())}),n}},outputFormatter:{value:function(e){var t=this,n=[];return r.each(e,function(e){n.push(c.Date.parse(t.get("dateFormat"),e))}),n}}},prototype:{ELEMENT_TEMPLATE:'<input class="'+k+'" type="hidden" />',initializer:function(){var t=this;t.after("calendar:dateClick",e.bind(t._afterDateSelect,t))},getElementsValue:function(){var e=this;return e.calendar.get("selectedDates")},formatDate:function(e){var t=this,n=t.get("dateFormat"),r=t.get("locale");return c.Date.format(e,{format:n,locale:r})},_afterDateSelect:function(){var e=this,t=e.calendar.get("selectedDates");e.elements.val(r.invoke(t,"getTime").join(","))},_afterRender:function(){var t=this;e.DateCellEditor.superclass._afterRender.apply(t,arguments),t.calendar=(new e.Calendar(t.get("calendar"))).render(t.bodyNode)},_setCalendar:function(t){var n=this;return e.merge({bubbleTargets:n},t)},_uiSetValue:function(e){var t=this,n=t.calendar,r;n&&(i(e)||(e=[e]),r=t.formatValue(t.get("outputFormatter"),e),n._clearSelection(),r[0]?(n.set("date",r[0]),n.selectDates(r)):n.set("date",new Date))}}});e.DateCellEditor=q},"2.5.0",{requires:["datatable-base","calendar","overlay","sortable","aui-datatype","aui-toolbar","aui-form-validator","aui-datatable-core"],skinnable:!0});
