YUI.add("aui-image-viewer-gallery",function(e,t){var n=e.Lang,r=n.isBoolean,i=n.isNumber,s=n.isObject,o=n.isString,u=function(){return Array.prototype.slice.call(arguments).join(" ")},a=e.getClassName,f=a("glyphicon"),l=a("glyphicon","pause"),c=a("glyphicon","play"),h=a("image-gallery","pagination"),p=a("image-gallery","pagination","thumb"),d=a("image-gallery","player"),v=a("image-gallery","player","content"),m=a("well"),g='<div class="'+h+'"></div>',y='<li><a class="'+u(p,m)+'"><img src="{src}" /></a></li>',b='<div class="'+d+'"></div>',w='<span class="'+v+'"></span>',E=e.Component.create({NAME:"image-gallery",ATTRS:{autoPlay:{value:!1,validator:r},delay:{value:7e3,validator:i},pagination:{value:{},setter:function(t){var n=this;return e.merge({formatter:e.bind(n._thumbnailFormatter,n),after:{changeRequest:function(e){n.fire("changeRequest",{lastState:e.lastState,state:e.state})}},render:n.get("paginationEl"),showControls:!1},t)},validator:s},paginationEl:{readyOnly:!0,valueFn:function(){return e.Node.create(g)}},paginationInstance:{value:null},paused:{value:!1,validator:r},pausedLabel:{value:"",validator:o},playing:{value:!1,validator:r},playingLabel:{value:"(playing)",validator:o},repeat:{value:!0,validator:r},showPlayer:{value:!0,validator:r},toolbar:{value:{},setter:"_setToolbar",validator:s},useOriginalImage:{value:!1,validator:r}},EXTENDS:e.ImageViewer,prototype:{toolbar:null,_timer:null,renderUI:function(){var e=this;E.superclass.renderUI.apply(this,arguments),e._renderPagination(),e.get("showPlayer")&&e._renderPlayer()},bindUI:function(){var e=this;E.superclass.bindUI.apply(this,arguments),e.on({playingChange:e._onPlayingChange,pausedChange:e._onPausedChange}),e.after("currentIndexChange",e._onCurrentIndexChange),e.publish("changeRequest",{defaultFn:this._changeRequest})},destroy:function(){var e=this;E.superclass.destroy.apply(this,arguments),e.get("paginationInstance").destroy(),e.toolbar.destroy()},hidePagination:function(){var e=this;e.get("paginationEl").hide()},pause:function(){var e=this;e.set("paused",!0),e.set("playing",!1),e._syncInfoUI()},play:function(){var e=this;e.set("paused",!1),e.set("playing",!0),e._syncInfoUI()},showPagination:function(){var e=this;e.get("paginationEl").show()},_cancelTimer:function(){var e=this;e._timer&&e._timer.cancel()},_onCurrentIndexChange:function(){var e=this.get("currentIndex"),t,n,r=this.get("paginationInstance"),i=r.get("total");n=e%i+1,t=e-n+2,r.set("offset",t),r._dispatchRequest({page:n})},_renderPagination:function(){var t=this,n=t.get("paginationEl");e.one("body").append(n.hide());var r=(new e.Pagination(t.get("pagination"))).render();t.set("paginationInstance",r)},_renderPlayer:function(){var t=this,n=t.get("paginationEl"),r=e.Node.create(w);n.append(e.Node.create(b).append(r)),t.toolbar=(new e.Toolbar(t.get("toolbar"))).render(r)},_setToolbar:function(t){var n=this;return n.get("showPlayer")&&(t=e.merge({children:[[{icon:[f,c].join(" "),on:{click:e.bind(n.play,n)}},{icon:[f,l].join(" "),on:{click:e.bind(n.pause,n)}}]]},t)),t},_startTimer:function(){var t=this,n=t.get("delay");t._cancelTimer(),t._timer=e.later(n,t,t._syncSlideShow)},_syncControlsUI:function(){var e=this;E.superclass._syncControlsUI.apply(this,arguments),e.get("visible")?e.showPagination():(e.hidePagination(),e._cancelTimer())},_syncSlideShow:function(){var e=this;e.hasNext()||(e.get("repeat")?e.set("currentIndex",-1):e._cancelTimer()),e.next()},_changeRequest:function(e){var t=this,n=e.lastState,r=e.state,i=r.page,s=this.get("paginationInstance");if(!t.get("visible"))return!1;if(!n||n&&n.page!==i)t.set("currentIndex",s.getOffsetPageNumber()-2),t._processChangeRequest()},_processChangeRequest:function(){var e=this,t=e.get("paused"),n=e.get("playing");n&&!t&&e._startTimer()},_thumbnailFormatter:function(e){var t=this,r=t.get("links").size(),i=e-1;if(e>r)return"";var s=t.getLink(i),o=null;if(t.get("useOriginalImage"))o=s.attr("href");else{var u=s.one("img");u&&(o=u.attr("src"))}return n.sub(y,{src:o})},_getInfoTemplate:function(){var e,t=this,n=t.get("paused"),r=t.get("playing");return r?e=t.get("playingLabel"):n&&(e=t.get("pausedLabel")),u(E.superclass._getInfoTemplate.apply(this,arguments),e)},_afterVisibleChange:function(e){var t=this;E.superclass._afterVisibleChange.apply(this,arguments),e.newVal&&t.get("autoPlay")&&t.play()},_onPausedChange:function(e){var t=this;e.newVal&&t._cancelTimer()},_onPlayingChange:function(e){var t=this;e.newVal&&t._startTimer()}}});e.ImageGallery=E},"2.5.0",{requires:["aui-image-viewer-base","aui-pagination","aui-toolbar"],skinnable:!0});
