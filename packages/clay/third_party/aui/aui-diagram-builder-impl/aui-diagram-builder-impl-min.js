YUI.add("aui-diagram-builder-impl",function(e,t){var n=e.Lang,r=n.isArray,i=n.isBoolean,s=n.isObject,o=n.isString,u=e.WidgetStdMod,a=e.Array,f=e.getClassName,l=f("diagram","builder","controls"),c=f("diagram","builder","field"),h=f("diagram","node"),p=f("diagram","node","content"),d=f("diagram","node","editing"),v=f("diagram","node","label"),m=f("diagram","node","selected"),g=f("diagram","node","shape","boundary"),y=f("diagram","node","suggest","connector"),b=function(e,t){var n=r(e)?e:e.get("boundingBox").getXY();return[n[0]+t[0],n[1]+t[1]]},w=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},E=function(e,t){var n=e.hotPoints,r=t.hotPoints,i=e.get("boundingBox").getXY(),s=t.get("boundingBox").getXY(),o,u,a,f,l=Infinity,c=[[0,0],[0,0]];for(a=0,o=n.length;a<o;a++){var h=n[a],p=b(i,h);for(f=0,u=r.length;f<u;f++){var d=r[f],v=b(s,d),m=w(v,p);m<l&&(c[0]=h,c[1]=d,l=m)}}return c},S=function(e,t){var n=r(t)?t:t.getXY(),i=r(e)?e:e.getXY();return a.map(i,function(e,t){return Math.max(0,e-n[t])})},x=function(t){return e.instanceOf(t,e.Connector)},T=function(t){return e.instanceOf(t,e.Map)},N=function(t){return e.instanceOf(t,e.DiagramBuilderBase)},C=function(t){return e.instanceOf(t,e.DiagramNode)},k=e.Component.create({NAME:"diagram-builder",ATTRS:{connector:{setter:"_setConnector",value:null},fieldsDragConfig:{value:null,setter:"_setFieldsDragConfig",validator:s},graphic:{valueFn:function(){return new e.Graphic},validator:s},highlightDropZones:{validator:i,value:!0},strings:{value:{addNode:"Add node",cancel:"Cancel",close:"Close",deleteConnectorsMessage:"Are you sure you want to delete the selected connector(s)?",deleteNodesMessage:"Are you sure you want to delete the selected node(s)?",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},showSuggestConnector:{validator:i,value:!0},suggestConnectorOverlay:{value:null,setter:"_setSuggestConnectorOverlay"}},EXTENDS:e.DiagramBuilderBase,FIELDS_TAB:0,SETTINGS_TAB:1,prototype:{editingConnector:null,editingNode:null,publishedSource:null,publishedTarget:null,selectedConnector:null,selectedNode:null,initializer:function(){var t=this,n=t.get("canvas");t.on({cancel:t._onCancel,"drag:drag":t._onDrag,"drag:end":t._onDragEnd,"drop:hit":t._onDropHit,save:t._onSave}),e.DiagramNodeManager.on({publishedSource:function(e){t.publishedTarget=null,t.publishedSource=e.publishedSource}}),n.on("mousedown",e.bind(t._onCanvasMouseDown,t)),n.on("mouseenter",e.bind(t._onCanvasMouseEnter,t)),t.handlerKeyDown=e.getDoc().on("keydown",e.bind(t._afterKeyEvent,t)),t.dropContainer.delegate("click",e.bind(t._onNodeClick,t),"."+h),t.dropContainer.delegate("mousedown",e.bind(t._onCloseButtonMouseDown,t),".diagram-builder-controls button"),t.dropContainer.delegate("mouseenter",e.bind(t._onNodeMouseEnter,t),"."+h),t.dropContainer.delegate("mouseleave",e.bind(t._onNodeMouseLeave,t),"."+h)},renderUI:function(){var t=this;e.DiagramBuilder.superclass.renderUI.apply(this,arguments),t._setupFieldsDrag(),t._renderGraphic()},syncUI:function(){var t=this;e.DiagramBuilder.superclass.syncUI.apply(this,arguments),t.syncConnectionsUI(),t.connector=t.get("connector")},syncConnectionsUI:function(){var e=this;e.get("fields").each(function(e){e.syncConnectionsUI()})},clearFields:function(){var e=this,t=[];e.get("fields").each(function(e){t.push(e)}),a.each(t,function(e){e.destroy()}),t=e.editingConnector=e.editingNode=e.selectedNode=null},closeEditProperties:function(){var t=this,n=t.editingNode,r=t.tabView;r.selectChild(e.DiagramBuilder.FIELDS_TAB),r.disableTab(e.DiagramBuilder.SETTINGS_TAB),n&&n.get("boundingBox").removeClass(d),t.editingConnector=t.editingNode=null},connect:function(t,n,r){var i=this;return o(t)&&(t=e.DiagramNode.getNodeByName(t)),o(n)&&(n=e.DiagramNode.getNodeByName(n)),t&&n&&t.connect(n.get("name"),r),i},connectAll:function(e){var t=this;return a.each(e,function(e){e.hasOwnProperty("source")&&e.hasOwnProperty("target")&&t.connect(e.source,e.target,e.connector)}),t},createField:function(e){var t=this;return C(e)||(e.builder=t,e.bubbleTargets=t,e=new(t.getFieldClass(e.type||"node"))(e)),e},deleteSelectedConnectors:function(){var t=this,n=t.getStrings(),r=t.getSelectedConnectors();r.length&&window.confirm(n.deleteConnectorsMessage)&&(a.each(r,function(t){var n=t.get("transition");e.DiagramNode.getNodeByName(n.source).disconnect(n)}),t.stopEditing())},deleteSelectedNode:function(){var e=this,t=e.getStrings(),n=e.selectedNode;n&&!n.get("required")&&window.confirm(t.deleteNodesMessage)&&(n.close(),e.editingNode=e.selectedNode=null,e.stopEditing())},destructor:function(){var e=this;e.get("suggestConnectorOverlay").destroy()},eachConnector:function(e){var t=this;t.get("fields").each(function(n){var r=n.get("transitions");a.each(r.values(),function(r){e.call(t,n.getConnector(r),r,n)})})},editConnector:function(t){var n=this;if(t){var r=n.tabView;n.closeEditProperties(),r.enableTab(e.DiagramBuilder.SETTINGS_TAB),r.selectChild(e.DiagramBuilder.SETTINGS_TAB),n.propertyList.set("data",t.getProperties()),n.editingConnector=n.selectedConnector=t}},editNode:function(t){var n=this;if(t){var r=n.tabView;n.closeEditProperties(),r.enableTab(e.DiagramBuilder.SETTINGS_TAB),r.selectChild(e.DiagramBuilder.SETTINGS_TAB),n.propertyList.set("data",t.getProperties()),t.get("boundingBox").addClass(d),n.editingNode=n.selectedNode=t}},getFieldClass:function(t){var n=e.DiagramBuilder.types[t];return n?n:(e.log("The field type: ["+t+"] couldn't be found."),null)},getNodesByTransitionProperty:function(e,t){var n=this,r=[],i;return n.get("fields").each(function(n){i=n.get("transitions"),a.each(i.values(),function(i){if(i[e]===t)return r.push(n),!1})}),r},getSelectedConnectors:function(){var e=this,t=[];return e.eachConnector(function(e){e.get("selected")&&t.push(e)}),t},getSourceNodes:function(e){var t=this;return t.getNodesByTransitionProperty("target",e.get("name"))},hideSuggestConnectorOverlay:function(){var e=this;e.connector.hide(),e.get("suggestConnectorOverlay").hide
();try{e.fieldsDrag.dd.set("lock",!1)}catch(t){}},isAbleToConnect:function(){var e=this;return!!e.publishedSource&&!!e.publishedTarget},isFieldsDrag:function(e){var t=this;return e===t.fieldsDrag.dd},plotField:function(e){var t=this;e.get("rendered")||e.render(t.dropContainer)},select:function(e){var t=this;t.unselectNodes(),t.selectedNode=e.set("selected",!0).focus()},showSuggestConnectorOverlay:function(e){var t=this,n=t.get("suggestConnectorOverlay");n.get("boundingBox").addClass(y),n.set("xy",e||t.connector.get("p2")).show();try{t.fieldsDrag.dd.set("lock",!0)}catch(r){}},stopEditing:function(){var e=this;e.unselectConnectors(),e.unselectNodes(),e.closeEditProperties()},toJSON:function(){var e=this,t={nodes:[]};return e.get("fields").each(function(e){var n={transitions:[]},r=e.get("transitions");a.each(e.SERIALIZABLE_ATTRS,function(t){n[t]=e.get(t)}),a.each(r.values(),function(t){var r=e.getConnector(t);t.connector=r.toJSON(),n.transitions.push(t)}),t.nodes.push(n)}),t},unselectConnectors:function(){var e=this;a.each(e.getSelectedConnectors(),function(e){e.set("selected",!1)})},unselectNodes:function(){var e=this,t=e.selectedNode;t&&t.set("selected",!1),e.selectedNode=null},_afterKeyEvent:function(t){var n=this;if(t.hasModifier()||e.getDoc().get("activeElement").test(":input,td"))return;t.isKey("esc")?n._onEscKey(t):(t.isKey("backspace")||t.isKey("delete"))&&n._onDeleteKey(t)},_deleteSelectedNode:function(e){var t=this;t.deleteSelectedConnectors(),t.deleteSelectedNode(),e.halt()},_onCancel:function(){var e=this;e.closeEditProperties()},_onCanvasMouseEnter:function(){var e=this;e.syncUI()},_onCloseButtonMouseDown:function(t){var n=this,r=t.currentTarget.ancestor(".diagram-node");C(e.Widget.getByNode(r))&&n._deleteSelectedNode(t)},_onDeleteKey:function(t){var n=this,r=n.getSelectedConnectors();C(e.Widget.getByNode(t.target))?n._deleteSelectedNode(t):r.length>0&&(n.deleteSelectedConnectors(),t.halt())},_onDrag:function(t){var n=this,r=t.target;if(n.isFieldsDrag(r)){var i=e.Widget.getByNode(r.get("dragNode"));i.alignTransitions(),a.each(n.getSourceNodes(i),function(e){e.alignTransitions()})}},_onDragEnd:function(t){var n=this,r=t.target,i=e.Widget.getByNode(r.get("dragNode"));i&&n.isFieldsDrag(r)&&i.set("xy",i.getLeftTop())},_onDropHit:function(e){var t=this,n=e.drag;if(t.isAvailableFieldsDrag(n)){var r=n.get("node").getData("availableField"),i=t.addField({xy:S(n.lastXY,t.dropContainer),type:r.get("type")});t.select(i)}},_onEscKey:function(e){var t=this;t.hideSuggestConnectorOverlay(),t.stopEditing(),e.halt()},_onCanvasMouseDown:function(){var e=this;e.stopEditing(),e.hideSuggestConnectorOverlay()},_onNodeClick:function(t){var n=this,r=e.Widget.getByNode(t.currentTarget);n.select(r),n._onNodeEdit(t),t.stopPropagation()},_onNodeEdit:function(t){var n=this;if(!t.target.ancestor("."+p,!0))return;var r=e.Widget.getByNode(t.currentTarget);r&&n.editNode(r)},_onNodeMouseEnter:function(t){var n=e.Widget.getByNode(t.currentTarget);n.set("highlighted",!0)},_onNodeMouseLeave:function(t){var n=this,r=n.publishedSource,i=e.Widget.getByNode(t.currentTarget);(!r||!r.boundaryDragDelegate.dd.get("dragging"))&&i.set("highlighted",!1)},_onSave:function(){var e=this,t=e.editingNode,n=e.editingConnector,r=e.propertyList.get("data");t?r.each(function(e){t.set(e.get("attributeName"),e.get("value"))}):n&&r.each(function(e){n.set(e.get("attributeName"),e.get("value"))})},_onSuggestConnectorNodeClick:function(e){var t=this,n=e.currentTarget.getData("availableField"),r=t.connector,i=t.addField({type:n.get("type"),xy:r.toCoordinate(r.get("p2"))});t.hideSuggestConnectorOverlay(),t.publishedSource.connectNode(i)},_renderGraphic:function(){var e=this;e.get("graphic").render(e.dropContainer)},_setConnector:function(t){var n=this;if(!x(t)){var r=n.get("canvas").getXY();t=new e.Connector(e.merge({builder:n,graphic:n.get("graphic"),lazyDraw:!0,p1:r,p2:r,shapeHover:null,showName:!1},t))}return t},_setFieldsDragConfig:function(t){var n=this,r=n.dropContainer;return e.merge({bubbleTargets:n,container:r,dragConfig:{plugins:[{cfg:{constrain:r},fn:e.Plugin.DDConstrained},{cfg:{scrollDelay:150,node:r},fn:e.Plugin.DDNodeScroll}]},nodes:"."+h},t||{})},_setSuggestConnectorOverlay:function(t){var n=this;if(!t){var r=e.getDoc().invoke("createDocumentFragment"),i,s;a.each(n.get("availableFields"),function(e){var t=e.get("node");r.appendChild(t.clone().setData("availableField",t.getData("availableField")))}),t=new e.Overlay({bodyContent:r,render:!0,visible:!1,width:280,zIndex:1e4}),i=t.get("boundingBox"),s=t.get("contentBox"),s.addClass("popover-content"),i.addClass("popover"),i.delegate("click",e.bind(n._onSuggestConnectorNodeClick,n),"."+c)}return t},_setupFieldsDrag:function(){var t=this;t.fieldsDrag=new e.DD.Delegate(t.get("fieldsDragConfig"))}}});e.DiagramBuilder=k,e.DiagramBuilder.types={};var L=e.Component.create({NAME:"diagram-node-manager",EXTENDS:e.Base});e.DiagramNodeManager=new L;var A=e.Component.create({NAME:"diagram-node",UI_ATTRS:["highlighted","name","required","selected"],ATTRS:{builder:{validator:N},connectors:{valueFn:"_connectorsValueFn",writeOnce:!0},controlsToolbar:{validator:s,valueFn:"_controlsToolbarValueFn"},description:{value:"",validator:o},graphic:{writeOnce:!0,validator:s},height:{value:60},highlighted:{validator:i,value:!1},name:{valueFn:function(){var t=this;return t.get("type")+ ++e.Env._uidx},validator:o},required:{value:!1,validator:i},selected:{value:!1,validator:i},shapeBoundary:{validator:s,valueFn:"_valueShapeBoundary"},highlightBoundaryStroke:{validator:s,value:{weight:7,color:"#484B4C",opacity:.25}},shapeInvite:{validator:s,value:{radius:12,type:"circle",stroke:{weight:6,color:"#ff6600",opacity:.8},fill:{color:"#ffd700",opacity:.8}}},strings:{value:{closeMessage:"Close",connectMessage:"Connect",description:"Description",editMessage:"Edit",name:"Name",type:"Type"}},tabIndex:{value:1},transitions:{value:null,writeOnce:!0,setter:"_setTransitions"},type:{value:"node",validator:o},width:{value:60},zIndex
:{value:100}},EXTENDS:e.Overlay,CIRCLE_POINTS:[[35,20],[28,33],[14,34],[5,22],[10,9],[24,6],[34,16],[31,30],[18,35],[6,26],[7,12],[20,5],[33,12],[34,26],[22,35],[9,30],[6,16],[16,6],[30,9],[35,22],[26,34],[12,33],[5,20],[12,7],[26,6],[35,18],[30,31],[16,34],[6,24],[9,10],[22,5],[34,14],[33,28],[20,35],[7,28],[6,14],[18,5],[31,10],[34,24],[24,34],[10,31],[5,18],[14,6],[28,8],[35,20],[28,33],[14,34],[5,22],[10,8],[25,6],[34,16],[31,30],[18,35],[6,26],[8,12],[20,5],[33,12],[33,27],[22,35],[8,30],[6,15],[16,6],[30,9],[35,23],[26,34],[12,32],[5,20],[12,7],[27,7],[35,18],[29,32],[15,34]],DIAMOND_POINTS:[[30,5],[35,10],[40,15],[45,20],[50,25],[55,30],[50,35],[45,40],[40,45],[35,50],[30,55],[25,50],[20,45],[15,40],[10,35],[5,30],[10,25],[15,20],[20,15],[25,10]],SQUARE_POINTS:[[5,5],[10,5],[15,5],[20,5],[25,5],[30,5],[35,5],[40,5],[50,5],[55,5],[60,5],[65,5],[65,10],[65,15],[65,20],[65,25],[65,30],[65,35],[65,40],[65,45],[65,50],[65,55],[65,60],[65,65],[60,65],[55,65],[50,65],[45,65],[40,65],[35,65],[30,65],[25,65],[20,65],[15,65],[10,65],[5,65],[5,60],[5,55],[5,50],[5,45],[5,40],[5,35],[5,30],[5,25],[5,20],[5,15],[5,10]],getNodeByName:function(t){return e.Widget.getByNode("[data-nodeId="+e.DiagramNode.buildNodeId(t)+"]")},buildNodeId:function(e){return"diagramNode_field_"+e.replace(/[^a-z0-9.:_\-]/ig,"_")},prototype:{LABEL_TEMPLATE:'<div class="'+v+'">{label}</div>',boundary:null,hotPoints:[[0,0]],CONTROLS_TEMPLATE:'<div class="'+l+'"></div>',SERIALIZABLE_ATTRS:["description","name","required","type","width","height","zIndex","xy"],initializer:function(){var t=this;t.after({"map:remove":e.bind(t._afterMapRemove,t),render:t._afterRender}),t.on({nameChange:t._onNameChange}),t.publish({connectDrop:{defaultFn:t.connectDrop},connectEnd:{defaultFn:t.connectEnd},connectMove:{defaultFn:t.connectMove},connectOutTarget:{defaultFn:t.connectOutTarget},connectOverTarget:{defaultFn:t.connectOverTarget},connectStart:{defaultFn:t.connectStart},boundaryMouseEnter:{},boundaryMouseLeave:{}}),t.get("boundingBox").addClass(h+"-"+t.get("type"))},destructor:function(){var e=this;e.eachConnector(function(e,t,n){n.removeTransition(e.get("transition"))}),e.invite.destroy(),e.get("graphic").destroy(),e.get("builder").removeField(e)},addTransition:function(t){var n=this,r=n.get("transitions");return t=n.prepareTransition(t),r.has(t.uid)||(t.uid=e.guid(),r.put(t.uid,t)),t},alignTransition:function(t){var n=this,r=e.DiagramNode.getNodeByName(t.target);if(r){var i=E(n,r);t=e.merge(t,{sourceXY:i[0],targetXY:i[1]}),n.getConnector(t).setAttrs({p1:b(n,t.sourceXY),p2:b(r,t.targetXY)})}},alignTransitions:function(){var t=this,n=t.get("transitions");a.each(n.values(),e.bind(t.alignTransition,t))},close:function(){var e=this;return e.destroy()},connect:function(t,n){var r=this;t=r.addTransition(t);var i=null,s=e.DiagramNode.getNodeByName(t.target);if(s&&!r.isTransitionConnected(t)){var o=r.get("builder"),u=E(r,s);e.mix(t,{sourceXY:u[0],targetXY:u[1]}),i=new e.Connector(e.merge({after:{selectedChange:function(){r.alignTransition(t)}},builder:o,graphic:o.get("graphic"),transition:t},n)),r.get("connectors").put(t.uid,i)}return r.alignTransition(t),i},connectDrop:function(e){var t=this;t.connectNode(e.publishedTarget)},connectEnd:function(){var e=this,t=e.get("builder"),n=t.publishedSource;!t.isAbleToConnect()&&t.get("showSuggestConnector")&&t.connector.get("visible")?t.showSuggestConnectorOverlay():(t.connector.hide(),n.invite.set("visible",!1)),t.get("highlightDropZones")&&t.get("fields").each(function(e){e.set("highlighted",!1)})},connectMove:function(e){var t=this,n=t.get("builder"),r=e.mouseXY;n.connector.set("p2",r);if(n.publishedTarget){var i=t.invite,s=i.get("radius")||0;i.get("visible")||i.set("visible",!0),i.setXY([r[0]-s,r[1]-s])}},connectNode:function(e){var t=this,n=t.boundaryDragDelegate.dd;t.connect(t.prepareTransition({sourceXY:S(n.startXY,t.get("boundingBox")),target:e.get("name"),targetXY:S(n.mouseXY,e.get("boundingBox"))}))},connectOutTarget:function(){var e=this,t=e.get("builder");t.publishedTarget=null,t.publishedSource.invite.set("visible",!1)},connectOverTarget:function(){var e=this,t=e.get("builder");t.publishedSource!==e&&(t.publishedTarget=e)},connectStart:function(t){var n=this,r=n.get("builder");r.connector.show().set("p1",t.startXY),r.get("highlightDropZones")&&r.get("fields").each(function(e){e.set("highlighted",!0)}),e.DiagramNodeManager.fire("publishedSource",{publishedSource:n})},disconnect:function(e){var t=this;t.isTransitionConnected(e)&&t.removeTransition(e)},eachConnector:function(e){var t=this,n=[],r=[].concat(t.get("connectors").values()),i=r.length;return a.each(t.get("builder").getSourceNodes(t),function(e){var i=e.get("connectors");a.each(i.values(),function(i){t.get("name")===i.get("transition").target&&(n.push(e),r.push(i))})}),a.each(r,function(r,s){e.call(t,r,s,s<i?t:n[s-i])}),r=n=null,r},getConnector:function(e){var t=this;return t.get("connectors").getValue(e.uid)},getContainer:function(){var e=this;return e.get("builder").dropContainer||e.get("boundingBox").get("parentNode")},getLeftTop:function(){var e=this;return S(e.get("boundingBox"),e.getContainer())},getProperties:function(){var e=this,t=e.getPropertyModel();return a.each(t,function(t){var r=e.get(t.attributeName),i=n.type(r);i==="boolean"&&(r=String(r)),t.value=r}),t},getPropertyModel:function(){var t=this,n=t.getStrings();return[{attributeName:"description",editor:new e.TextAreaCellEditor,name:n.description},{attributeName:"name",editor:new e.TextCellEditor({validator:{rules:{value:{required:!0}}}}),name:n.name},{attributeName:"type",editor:!1,name:n.type}]},isBoundaryDrag:function(e){var t=this;return e===t.boundaryDragDelegate.dd},isTransitionConnected:function(e){var t=this;return t.get("connectors").has(e.uid)},prepareTransition:function(t){var n=this,r={source:n.get("name"),target:null,uid:e.guid()};return o(t)?r.target=t:s(t)&&(r=e.merge(r,t)),r},removeTransition:function(e){var t=this;return t.get("transitions").remove(e.uid
)},renderShapeBoundary:function(){var e=this,t=e.boundary=e.get("graphic").addShape(e.get("shapeBoundary"));return t},renderShapeInvite:function(){var e=this,t=e.invite=e.get("builder").get("graphic").addShape(e.get("shapeInvite"));return t.set("visible",!1),t},syncConnectionsUI:function(){var e=this,t=e.get("transitions");a.each(t.values(),function(t){e.connect(t,t.connector)})},_afterConnectorRemove:function(e){e.value.destroy()},_afterRender:function(){var e=this;e.setStdModContent(u.BODY,"",u.AFTER),e._renderGraphic(),e._renderControls(),e._renderLabel(),e._uiSetHighlighted(e.get("highlighted"))},_afterTransitionsRemove:function(e){var t=this;t.get("connectors").remove(e.value.uid)},_bindBoundaryEvents:function(){var t=this;t.boundary.detachAll().on({mouseenter:e.bind(t._onBoundaryMouseEnter,t),mouseleave:e.bind(t._onBoundaryMouseLeave,t)})},_connectorsValueFn:function(){var t=this;return new e.Map({after:{remove:e.bind(t._afterConnectorRemove,t)}})},_controlsToolbarValueFn:function(){var t=this;return{children:[{icon:"glyphicon glyphicon-remove",on:{click:e.bind(t._handleCloseEvent,t)}}]}},_handleCloseEvent:function(){var e=this;e.get("builder").deleteSelectedNode()},_handleConnectStart:function(e){var t=this;t.fire("connectStart",{startXY:e})},_handleConnectMove:function(e){var t=this,n=t.get("builder");t.fire("connectMove",{mouseXY:e,publishedSource:n.publishedSource})},_handleConnectEnd:function(){var e=this,t=e.get("builder"),n=t.publishedSource,r=t.publishedTarget;n&&r&&e.fire("connectDrop",{publishedSource:n,publishedTarget:r}),e.fire("connectEnd",{publishedSource:n})},_handleConnectOutTarget:function(){var e=this,t=e.get("builder"),n=t.publishedSource;n&&e.fire("connectOutTarget",{publishedSource:n})},_handleConnectOverTarget:function(){var e=this,t=e.get("builder"),n=t.publishedSource;n&&e.fire("connectOverTarget",{publishedSource:n})},_onBoundaryDrag:function(){var e=this,t=e.boundaryDragDelegate.dd;e._handleConnectMove(t.con._checkRegion(t.mouseXY))},_onBoundaryDragEnd:function(e){var t=this;t._handleConnectEnd(),e.target.get("dragNode").show()},_onBoundaryDragStart:function(e){var t=this;t._handleConnectStart(t.boundaryDragDelegate.dd.startXY),e.target.get("dragNode").hide()},_onBoundaryMouseEnter:function(e){var t=this;t.fire("boundaryMouseEnter",{domEvent:e}),t._handleConnectOverTarget()},_onBoundaryMouseLeave:function(e){var t=this;t.fire("boundaryMouseLeave",{domEvent:e}),t._handleConnectOutTarget()},_onNameChange:function(e){var t=this;t.eachConnector(function(n,r,i){var s=n.get("transition");s[t===i?"source":"target"]=e.newVal,n.set("transition",s)})},_renderControls:function(){var t=this,n=t.get("boundingBox");t.controlsNode=e.Node.create(t.CONTROLS_TEMPLATE).appendTo(n)},_renderControlsToolbar:function(){var t=this;t.controlsToolbar=(new e.Toolbar(t.get("controlsToolbar"))).render(t.controlsNode),t._uiSetRequired(t.get("required"))},_renderGraphic:function(){var t=this;t.set("graphic",new e.Graphic({height:t.get("height"),render:t.bodyNode,width:t.get("width")})),t.renderShapeInvite(),t.renderShapeBoundary().addClass(g),t._bindBoundaryEvents(),t._setupBoundaryDrag()},_renderLabel:function(){var t=this;t.labelNode=e.Node.create(n.sub(t.LABEL_TEMPLATE,{label:t.get("name")})),t.get("contentBox").placeAfter(t.labelNode)},_setTransitions:function(t){var n=this;if(!T(t)){var r=new e.Map({after:{remove:e.bind(n._afterTransitionsRemove,n)}});e.Array.each(t,function(t){var i=e.guid();t=s(t)?e.mix(t,{uid:i}):{uid:i,target:t},r.put(i,n.prepareTransition(t))}),t=r}return t},_setupBoundaryDrag:function(){var t=this,n=t.get("builder");t.boundaryDragDelegate=new e.DD.Delegate({bubbleTargets:t,container:t.bodyNode,nodes:"."+g,dragConfig:{useShim:!1,plugins:[{cfg:{constrain:n?n.get("canvas"):null},fn:e.Plugin.DDConstrained},{cfg:{scrollDelay:150},fn:e.Plugin.DDWinScroll},{cfg:{borderStyle:"0px",moveOnEnd:!1,resizeFrame:!1},fn:e.Plugin.DDProxy}]},on:{"drag:drag":e.bind(t._onBoundaryDrag,t),"drag:end":e.bind(t._onBoundaryDragEnd,t),"drag:start":e.bind(t._onBoundaryDragStart,t)}}),e.Do.after(t._bindBoundaryEvents,t.boundaryDragDelegate.dd,"_unprep",t)},_uiSetHighlighted:function(e){var t=this;if(t.get("rendered")){var n=e?t.get("highlightBoundaryStroke"):t.get("shapeBoundary.stroke");n&&t.boundary.set("stroke",n)}},_uiSetName:function(t){var n=this,r=n.get("boundingBox");r.setAttribute("data-nodeId",e.DiagramNode.buildNodeId(t)),n.get("rendered")&&n.labelNode.setContent(t)},_uiSetRequired:function(){},_uiSetSelected:function(e){var t=this;t.get("boundingBox").toggleClass(m,e),e&&!t.controlsToolbar&&t._renderControlsToolbar()},_uiSetXY:function(e){var t=this,n=t.getContainer().getXY();this._posNode.setXY([e[0]+n[0],e[1]+n[1]])},_valueShapeBoundary:function(){return{height:41,type:"rect",stroke:{weight:7,color:"transparent",opacity:0},width:41}}}});e.DiagramNode=A,e.DiagramBuilder.types.node=e.DiagramNode,e.DiagramNodeState=e.Component.create({NAME:"diagram-node",ATTRS:{height:{value:40},type:{value:"state"},width:{value:40}},EXTENDS:e.DiagramNode,prototype:{hotPoints:e.DiagramNode.CIRCLE_POINTS,renderShapeBoundary:function(){var e=this,t=e.boundary=e.get("graphic").addShape(e.get("shapeBoundary"));return t.translate(5,5),t},_valueShapeBoundary:function(){return{radius:15,type:"circle",stroke:{weight:7,color:"transparent",opacity:0}}}}}),e.DiagramBuilder.types.state=e.DiagramNodeState,e.DiagramNodeCondition=e.Component.create({NAME:"diagram-node",ATTRS:{height:{value:60},type:{value:"condition"},width:{value:60}},EXTENDS:e.DiagramNodeState,prototype:{hotPoints:e.DiagramNode.DIAMOND_POINTS,renderShapeBoundary:function(){var e=this,t=e.boundary=e.get("graphic").addShape(e.get("shapeBoundary"));return t.translate(10,10),t.rotate(45),t},_valueShapeBoundary:e.DiagramNode.prototype._valueShapeBoundary}}),e.DiagramBuilder.types.condition=e.DiagramNodeCondition,e.DiagramNodeStart=e.Component.create({NAME:"diagram-node",ATTRS:{type:{value:"start"}},EXTENDS:e.DiagramNodeState}),e.DiagramBuilder.types
.start=e.DiagramNodeStart,e.DiagramNodeEnd=e.Component.create({NAME:"diagram-node",ATTRS:{type:{value:"end"}},EXTENDS:e.DiagramNodeState}),e.DiagramBuilder.types.end=e.DiagramNodeEnd,e.DiagramNodeJoin=e.Component.create({NAME:"diagram-node",ATTRS:{height:{value:60},type:{value:"join"},width:{value:60}},EXTENDS:e.DiagramNodeState,prototype:{hotPoints:e.DiagramNode.DIAMOND_POINTS,renderShapeBoundary:e.DiagramNodeCondition.prototype.renderShapeBoundary,_valueShapeBoundary:e.DiagramNode.prototype._valueShapeBoundary}}),e.DiagramBuilder.types.join=e.DiagramNodeJoin,e.DiagramNodeFork=e.Component.create({NAME:"diagram-node",ATTRS:{height:{value:60},type:{value:"fork"},width:{value:60}},EXTENDS:e.DiagramNodeState,prototype:{hotPoints:e.DiagramNode.DIAMOND_POINTS,renderShapeBoundary:e.DiagramNodeCondition.prototype.renderShapeBoundary,_valueShapeBoundary:e.DiagramNode.prototype._valueShapeBoundary}}),e.DiagramBuilder.types.fork=e.DiagramNodeFork,e.DiagramNodeTask=e.Component.create({NAME:"diagram-node",ATTRS:{height:{value:70},type:{value:"task"},width:{value:70}},EXTENDS:e.DiagramNodeState,prototype:{hotPoints:e.DiagramNode.SQUARE_POINTS,renderShapeBoundary:function(){var e=this,t=e.boundary=e.get("graphic").addShape(e.get("shapeBoundary"));return t.translate(8,8),t},_valueShapeBoundary:function(){return{height:55,type:"rect",stroke:{weight:7,color:"transparent",opacity:0},width:55}}}}),e.DiagramBuilder.types.task=e.DiagramNodeTask},"2.5.0",{requires:["overlay","aui-map","aui-diagram-builder-base","aui-diagram-builder-connector"],skinnable:!0});
