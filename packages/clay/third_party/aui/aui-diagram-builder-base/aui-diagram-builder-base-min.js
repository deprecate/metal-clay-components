YUI.add("aui-diagram-builder-base",function(e,t){var n=e.Lang,r=n.isArray,i=n.isBoolean,s=n.isNumber,o=n.isObject,u=n.isString,a=function(t){return e.instanceOf(t,e.ArrayList)},f=function(t){return e.instanceOf(t,e.Node)},l=function(t){return e.instanceOf(t,e.AvailableField)},c=e.Array,h=e.getClassName,p=h("clearfix"),d=h("diagram","builder","canvas"),v=h("diagram","builder","content","container"),m=h("diagram","builder","drop","container"),g=h("diagram","builder","field"),y=h("diagram","builder","field","draggable"),b=h("diagram","builder","field","icon"),w=h("diagram","builder","field","label"),E=h("diagram","builder","fields","container"),S=h("diagram","builder","tabs"),x=h("diagram","builder","toolbar","container"),T=h("icon"),N=h("layout"),C=h("tabbable"),k=h("tabbable","content"),L=h("table","striped"),A=e.Component.create({NAME:"availableField",ATTRS:{draggable:{value:!0,validator:i},label:{validator:u},iconClass:{validator:u},id:{value:e.guid(),setter:"_setId",validator:u},node:{valueFn:function(t){var n=this;return f(t)||(t=e.Node.create(e.Lang.sub(n.FIELD_ITEM_TEMPLATE,{iconClass:n.get("iconClass")})),t.setData("availableField",n)),t},validator:f,writeOnce:!0},type:{value:"node",validator:u}},EXTENDS:e.Base,buildNodeId:function(e){return"availableFields_field_"+e},getAvailableFieldById:function(t){return e.AvailableField.getAvailableFieldByNode("#"+e.AvailableField.buildNodeId(t))},getAvailableFieldByNode:function(t){return t=e.one(t),f(t)?t.getData("availableField"):null},prototype:{FIELD_ITEM_TEMPLATE:'<li class="'+g+'">'+'<span class="'+[T,b].join(" ")+' {iconClass}"></span>'+'<div class="'+w+'"></div>'+"</li>",initializer:function(){var e=this,t=e.get("node");e.after({draggableChange:e._afterDraggableChange,idChange:e._afterIdChange,labelChange:e._afterLabelChange}),e.labelNode=t.one("."+w),e._uiSetDraggable(e.get("draggable")),e._uiSetId(e.get("id")),e._uiSetLabel(e.get("label"))},_afterDraggableChange:function(e){var t=this;t._uiSetDraggable(e.newVal)},_afterIdChange:function(e){var t=this;t._uiSetId(e.newVal)},_afterLabelChange:function(e){var t=this;t._uiSetLabel(e.newVal)},_setId:function(t){return e.AvailableField.buildNodeId(t)},_uiSetDraggable:function(e){var t=this;t.get("node").toggleClass(y,e)},_uiSetId:function(e){var t=this;t.get("node").set("id",e)},_uiSetLabel:function(e){var t=this;t.get("node").attr("title",e),t.labelNode.setContent(e)}}});e.AvailableField=A;var O=function(){};O.ATTRS={fields:{value:[],setter:"_setFields",validator:function(e){return r(e)||a(e)}},maxFields:{value:Infinity,validator:s}},e.mix(O.prototype,{_setFields:function(e){var t=this;return a(e)?e:t.createFields(e)},_updateFields:function(e){var t=this;t.set("fields",e)},addField:function(e,t){var n=this;if(n.get("fields").size()<n.get("maxFields")){var r=n.createField(e);return r&&n._updateFields(n.get("fields").add(r,t)),r}return null},createFields:function(t){var n=this,r=[];return c.each(t,function(e,t){t<n.get("maxFields")&&r.push(n.createField(e))}),new e.ArrayList(r)},removeField:function(e){var t=this;t._updateFields(t.get("fields").remove(e))},createField:function(e){return e}}),e.FieldSupport=O;var M=e.Component.create({NAME:"diagram-builder",ATTRS:{availableFields:{setter:"_setAvailableFields",validator:r},availableFieldsDragConfig:{value:null,setter:"_setAvailableFieldsDragConfig",validator:o},canvas:{valueFn:function(){return e.Node.create(this.CANVAS_TEMPLATE)}},dropConfig:{value:null,setter:"_setDropConfig",validator:o},contentContainer:{valueFn:function(){return e.Node.create(this.CONTENT_CONTAINER_TEMPLATE)}},dropContainer:{valueFn:function(){return e.Node.create(this.DROP_CONTAINER_TEMPLATE)}},fieldsContainer:{valueFn:function(){return e.Node.create(this.FIELDS_CONTAINER_TEMPLATE)}},propertyList:{setter:"_setPropertyList",validator:o,value:null},strings:{value:{addNode:"Add node",cancel:"Cancel",close:"Close",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},tabView:{setter:"_setTabView",validator:o,value:null,writeOnce:!0},toolbar:{setter:"_setToolbar",validator:o,value:null},toolbarContainer:{valueFn:function(){return e.Node.create(this.TOOLBAR_CONTAINER_TEMPLATE)}}},HTML_PARSER:{contentContainer:"."+v,dropContainer:"."+m,fieldsContainer:"."+E,toolbarContainer:"."+x,canvas:"."+d},UI_ATTRS:["availableFields","fields"],AUGMENTS:[e.FieldSupport],prototype:{CANVAS_TEMPLATE:'<div tabindex="1" class="'+d+'"></div>',CONTENT_CONTAINER_TEMPLATE:'<div class="'+v+'"></div>',DROP_CONTAINER_TEMPLATE:'<div class="'+m+'"></div>',FIELDS_CONTAINER_TEMPLATE:'<ul class="'+[E,p].join(" ")+'"></ul>',TOOLBAR_CONTAINER_TEMPLATE:'<div class="'+x+'"></div>',fieldsNode:null,propertyList:null,settingsNode:null,tabView:null,toolbar:null,initializer:function(){var e=this;e.publish({cancel:{defaultFn:e._defCancelFn}}),e.after({render:e._afterRender,"model:change":e._afterModelChange}),e.after(e._afterUiSetHeight,e,"_uiSetHeight"),e.canvas=e.get("canvas"),e.contentContainer=e.get("contentContainer"),e.dropContainer=e.get("dropContainer"),e.fieldsContainer=e.get("fieldsContainer"),e.toolbarContainer=e.get("toolbarContainer")},isAvailableFieldsDrag:function(e){var t=this,n=t.availableFieldsDrag;return e===n.dd},plotFields:function(){var e=this,t=e.get("fields");t.each(function(t){e.plotField(t)})},renderUI:function(){var e=this;e._renderTabs(),e._renderCanvas(),e._uiSetAvailableFields(e.get("availableFields"))},syncUI:function(){var e=this,t=e.get("contentBox");e._setupDrop(),e._setupAvailableFieldsDrag(),t.addClass(N)},_afterModelChange:function(){var e=this;e._handleSaveEvent()},_afterRender:function(){var e=this;e.plotFields()},_afterSelectionChange:function(e){var t=this,n=e.newVal,r;n&&(r=n.get("panelNode"),t.get("rendered")&&r===t.settingsNode&&t._renderSettings())},_afterUiSetHeight:function(e){var t=this;t.contentContainer.setStyle("height",s(e)?e+t.DEF_UNIT:e),t.dropContainer.setStyle("height",s(e)?e+t.DEF_UNIT:e)},_defCancelFn:function(){var e=this;e.tabView.selectChild
(0)},_handleCancelEvent:function(){var e=this;e.fire("cancel")},_handleSaveEvent:function(){var e=this;e.fire("save")},_renderCanvas:function(){var e=this,t=e.get("contentBox"),n=e.canvas,r=e.contentContainer,i=e.dropContainer;n.inDoc()||r.appendChild(n),i.inDoc()||n.appendChild(i),r.inDoc()?r.get("parentNode").append(r):t.appendChild(r)},_renderPropertyList:function(){var t=this;if(!t.propertyList){var n=t.propertyList=new e.PropertyList(t.get("propertyList"));n.render(t.settingsNode),n.get("boundingBox").unselectable().addClass(L)}},_renderSettings:function(){var e=this;e._renderPropertyList(),e._renderToolbar()},_renderTabs:function(){var t=this;if(!t.tabView){var n=new e.TabView(t.get("tabView"));t.tabView=n,t.fieldsNode=n.item(0).get("panelNode"),t.settingsNode=n.item(1).get("panelNode")}},_renderToolbar:function(){var t=this;t.toolbar||(t.toolbar=(new e.Toolbar(t.get("toolbar"))).render(t.settingsNode))},_setupDrop:function(){var t=this;t.drop=new e.DD.Drop(t.get("dropConfig"))},_setupAvailableFieldsDrag:function(){var t=this;t.availableFieldsDrag=new e.DD.Delegate(t.get("availableFieldsDragConfig"))},_setAvailableFields:function(t){var n=[];return c.each(t,function(t){n.push(l(t)?t:new e.AvailableField(t))}),n},_setDropConfig:function(t){var n=this;return e.merge({bubbleTargets:n,groups:["availableFields"],node:n.dropContainer},t||{})},_setAvailableFieldsDragConfig:function(t){var n=this;return e.merge({bubbleTargets:n,container:n.get("boundingBox"),dragConfig:{groups:["availableFields"],plugins:[{cfg:{moveOnEnd:!1},fn:e.Plugin.DDProxy}]},nodes:"."+y},t||{})},_setPropertyList:function(t){var n=this;return e.merge({bubbleTargets:n,scroll:{height:400,width:"auto"},width:"99%"},t)},_setTabView:function(t){var n=this,r=n.get("boundingBox"),i=r.one("."+k),s;s={after:{selectionChange:e.bind(n._afterSelectionChange,n)},boundingBox:r.one("."+C),bubbleTargets:n,cssClass:S,render:n.get("contentBox"),srcNode:i};if(!i){var o=n.getStrings();s.children=[{label:o.addNode},{label:o.settings,disabled:!0}]}return e.merge(s,t)},_setToolbar:function(t){var n=this,r=n.getStrings();return e.merge({bubbleTargets:n,children:[{on:{click:e.bind(n._handleCancelEvent,n)},label:r.close}]},t)},_uiSetAvailableFields:function(t){var n=this,r=n.fieldsNode;if(r){var i=e.getDoc().invoke("createDocumentFragment");c.each(t,function(e){i.appendChild(e.get("node"))}),r.setContent(n.fieldsContainer.setContent(i))}},_uiSetFields:function(){var e=this;e.get("rendered")&&e.plotFields()}}});e.DiagramBuilderBase=M},"2.5.0",{requires:["dd","collection","aui-tabview","aui-datatable-property-list"],skinnable:!0});
